# ТЕКУЩИЕ ЗАДАЧИ

## Активная задача  
**Статус:** BUILD MODE - Level 3-4 Completed ✅
**Описание:** Фундаментальные изменения v3.0 - Интеграция с Google Sheets

## ПОСЛЕДНЕЕ ИЗМЕНЕНИЕ (BUILD MODE)
**Дата:** 2024-12-19
**Задача:** Кардинальная реструктуризация системы - переход на Google Sheets как источник данных
**Изменения:**
- Добавлены зависимости Google Sheets API: google-auth, gspread, google-api-python-client
- Добавлены переменные окружения: SPREADSHEET_ID, SHEET_NAME
- Новые функции: get_google_sheets_client(), load_google_sheets_data(), update_google_sheets_stock()
- Изменена архитектура: остатки из email → обновление Google таблицы → загрузка полных данных
- Переписана функция upload_feed_to_github() для работы с DataFrame и заголовками
- Обновлена документация (README.md, changes.md)
- Статус: ✅ Выполнено полностью

## Новая архитектура v3.0
**Источники данных:**
- Остатки: Email архивы из 1С (как раньше)
- Цены и номенклатура: Google таблица

**Логика работы:**
1. Получение email с остатками из 1С
2. Извлечение данных об остатках (Артикул + Кол-во)
3. Обновление столбца "Кол-во" в Google таблице по артикулам
4. Загрузка всех данных из обновленной Google таблицы
5. Фильтрация товаров с нулевыми остатками
6. Загрузка итогового Excel файла с заголовками на GitHub Pages

## Чек-лист выполнения v3.0
- [x] Добавление зависимостей Google Sheets API
- [x] Создание функций для работы с Google Sheets
- [x] Изменение логики upload_feed_to_github для работы с заголовками
- [x] Переписывание process_google_sheets_with_stock (была process_price_files)
- [x] Обновление основной логики в main()
- [x] Обновление переменных окружения в env_example.txt
- [x] Обновление документации (README.md)
- [x] Создание changes.md с логом изменений
- [x] Обновление истории изменений в коде
- [x] Финальная проверка архитектуры

## Компоненты системы v3.0
1. **Извлечение остатков** - Gmail IMAP подключение (остается как раньше)
2. **Обработка архивов** - ZIP распаковка, парсинг остатков
3. **Интеграция Google Sheets** - Обновление остатков, загрузка данных
4. **Обработка данных** - Фильтрация, валидация, ограничение остатков
5. **Экспорт** - Excel с заголовками на GitHub Pages

## Готовность к развертыванию
- Код готов к production
- Документация обновлена
- Требуется настройка Google Sheets API (credentials.json)
- Требуется обновление .env файла с новыми переменными
- Требуется пересборка Docker образа

## Предыдущие изменения (история)
### v2.1 - Смена источника данных об остатках (2024-12-19)
- Изменен источник данных с столбца "В наличии" (G) на столбец "Доступно" (J)
- Файл: main.py, строка 245
- Статус: ✅ Выполнено и протестировано

### v2.0 - Основная функциональность
- Основная функциональность ETL-конвейера
- Адаптация под новую почтовую рассылку "Остатки Подольск от"  
- Обновление структуры выходных данных
- Группировка дубликатов и суммирование остатков 